/* 修复 KaTeX 数学公式下标显示问题，增强兼容性 */
.katex, .katex * {
	font-family: 'KaTeX_Main', 'Times New Roman', Times, serif !important;
	line-height: 1.2 !important;
	vertical-align: baseline !important;
}

/* 防止公式被裁剪 */
.katex {
	overflow: visible !important;
}
.wrap {
	border: none;
	padding: 0;
	height: 100%;
	box-sizing: border-box;
	/* overflow: hidden; 移除，避免裁剪公式 */
	background: transparent;
	min-height: 0;
	display: flex;
	flex-direction: column;
}
/* 强化 KaTeX 隔离，防止全局样式污染 */
:global(.katex), :global(.katex *) {
	font-family: 'KaTeX_Main', 'Times New Roman', Times, serif !important;
	line-height: 1.2 !important;
	vertical-align: baseline !important;
	font-size: 1em !important;
}
:global(.katex) {
	overflow: visible !important;
}
.content { color: var(--brand-text); line-height: 1.8; padding: 0; height: 100%; overflow: auto; box-sizing: border-box; }

.controls {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 12px 0 8px 0;
}
.toggleBtn, .fullBtn {
  background: #fff;
  border: 1px solid var(--brand-border);
  color: var(--brand-accent);
  padding: 6px 10px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
}
.toggleBtn:hover, .fullBtn:hover { background: var(--brand-accent-soft); border-color: var(--brand-accent); box-shadow: var(--brand-shadow); }
.toggleBtn:active, .fullBtn:active { transform: translateY(1px) scale(0.98); }

.container { flex: 1 1 0; overflow: hidden; min-height: 0; }
.editor { width: 100%; height: 100%; box-sizing: border-box; padding: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace; font-size: 13px; border-radius: 6px; border: 1px solid var(--brand-border); min-height: 0; resize: vertical; overflow: auto; }
.containerRaw .editor { animation: fadeSlide 0.24s ease; }
.containerRender .content { animation: fadeSlide 0.24s ease; }
.containerRender .empty { animation: fadeSlide 0.24s ease; }

/* KaTeX隔离区，彻底避免父级样式影响公式布局 */
.content .katex-isolate {
	all: initial;
	font-size: 1.1em;
	color: var(--brand-text);
	/* 重新引入KaTeX官方字体和样式 */
	font-family: 'KaTeX_Main', 'Times New Roman', Times, serif;
}
.content h1 { font-size: 20px; margin: 0 0 12px 0; }
.content h2 { font-size: 18px; margin: 8px 0; }
.content ul { padding-left: 20px; }
.content p { margin: 6px 0 10px 0; }
.content pre { background: transparent; padding: 8px; }

/* KaTeX fixes: ensure block math centers and inline math aligns with text */
.content .katex {
	display: inline-block;
	line-height: normal;
	vertical-align: middle;
}

.content .katex-display {
	display: flex;
	justify-content: center;
	align-items: center;
	text-align: center;
	margin: 18px 0;
	width: 100%;
}

/* Ensure katex inner HTML uses inline-block so centering works */
.content .katex .katex-html {
	display: inline-block;
}

/* Prevent unexpected transforms/line-height from parent rules */
.content .katex {
	/* Isolate KaTeX font and sizing but keep internal transforms for proper script placement */
	font-family: 'KaTeX_Main', 'Times New Roman', Times, serif !important;
	font-style: normal !important;
	font-weight: normal !important;
	font-size: 1em !important;
	line-height: normal !important;
	display: inline-block;
	vertical-align: baseline;
}

.content .katex * {
	font-family: inherit !important;
}

/* Ensure block formula is centered within its container and not affected by parent flex */
.content > .katex-display, .content .katex-display > .katex {
	margin-left: auto !important;
	margin-right: auto !important;
}

/* Make sure SVG/CSS inside KaTeX scale normally */
.content .katex svg {
	transform: none !important;
}

/* Compatibility tweaks: adjust vlist positioning when parent styles interfere.
	 This nudges subscripts/superscripts back toward the baseline when they render too low.
	 If your global typography (line-height, font-size) changes, consider isolating KaTeX container instead. */
.content .katex .vlist {
	position: relative !important;
	top: -0.22em !important;
}

.content .katex .baseline-fix {
	display: none !important;
}
.pre { white-space: pre-wrap; word-break: break-word; margin: 0; color: #3b3350; }
.empty { color: #888; }

@keyframes fadeSlide {
	from {
		opacity: 0;
		transform: translateY(6px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}
