import{r as i,j as e,F as Le,R as z,T as Ee}from"./index-wVL-EJ1g.js";import{P as _e,s as pe}from"./style.module-D7bZyTPS.js";import{L as Me,l as ce,M as ve,C as fe,D as Ie,e as Ae,d as $e,b as He,c as U,a as Pe}from"./index-DhZzHwH3.js";const Ve="_layout_1om69_35",Oe="_canvasCard_1om69_42",We="_canvasHeader_1om69_50",qe="_editBtn_1om69_62",I={layout:Ve,canvasCard:Oe,canvasHeader:We,editBtn:qe},Fe=({items:g,onEdit:_,onCreate:L,onDelete:E,onRename:$})=>{const[S,w]=i.useState(!1),[B,N]=i.useState(!1),[A,l]=i.useState(null),[h,p]=i.useState(""),v=({value:r,onChange:M})=>{const O=r||{easy:30,medium:50},[x,W]=i.useState(O.easy),[f,C]=i.useState(O.easy+O.medium),H=z.useRef(null),T=z.useRef(null);z.useEffect(()=>{const o=r||{easy:30,medium:50};W(o.easy),C(o.easy+o.medium)},[r]);const k=(o,m=0,d=100)=>Math.max(m,Math.min(d,o)),u=(o,m)=>{const d=Math.round(k(o,0,m)),b=Math.round(k(m-o,0,100-d)),j=100-d-b;M({easy:d,medium:b,hard:j})},R=o=>{const m=H.current;if(!m||!T.current)return;const d=m.getBoundingClientRect(),b=(o-d.left)/d.width*100;if(T.current==="p1"){const j=k(b,0,f-1);W(j),u(j,f)}else if(T.current==="p2"){const j=k(b,x+1,100);C(j),u(x,j)}};return z.useEffect(()=>{const o=b=>R(b.clientX),m=b=>R(b.touches[0].clientX),d=()=>{T.current=null};return window.addEventListener("mousemove",o),window.addEventListener("touchmove",m),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",m),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)}},[x,f]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx("div",{style:{padding:"6px 12px",borderRadius:8,background:"#fbf7ff"},children:e.jsxs("div",{ref:H,style:{height:12,background:"#f0e7ff",borderRadius:8,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:`${x}%`,background:"#6b2fb1",borderRadius:8}}),e.jsx("div",{style:{position:"absolute",left:`${x}%`,top:0,bottom:0,width:`${f-x}%`,background:"#b080ff"}}),e.jsx("div",{style:{position:"absolute",left:`${f}%`,top:0,bottom:0,right:0,background:"#e9ddff",borderRadius:8}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(x),onMouseDown:o=>{o.preventDefault(),T.current="p1"},onTouchStart:()=>{T.current="p1"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${x}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(f),onMouseDown:o=>{o.preventDefault(),T.current="p2"},onTouchStart:()=>{T.current="p2"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${f}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}})]})}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("label",{style:{minWidth:60},children:"简单"}),e.jsx("input",{type:"number",value:Math.round(x),onChange:o=>{const m=Number(o.target.value||0),d=k(m,0,f-1);W(d),u(d,f)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"中等"}),e.jsx("input",{type:"number",value:Math.round(f-x),onChange:o=>{const m=Number(o.target.value||0),d=k(x+m,x+1,100);C(d),u(x,d)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"困难"}),e.jsx("input",{type:"number",value:Math.round(100-f),onChange:o=>{const m=Number(o.target.value||0),d=k(100-m,x+1,100);C(d),u(x,d)},style:{width:72}})]})]})};return e.jsxs("div",{children:[e.jsx(_e,{title:"试卷设计"}),e.jsx("div",{className:pe.content,children:e.jsx("div",{className:I.layout,children:e.jsx("div",{className:I.leftPane,children:e.jsxs("div",{className:I.canvasCard,children:[e.jsxs("div",{className:I.canvasHeader,children:[e.jsxs("div",{className:"titleLeft",children:["已创建的试卷 (",g.length,")"]}),e.jsx("div",{children:e.jsx("button",{className:I.editBtn,onClick:()=>w(!0),children:"新建试卷"})})]}),e.jsx("div",{style:{padding:12},children:e.jsx(Me,{items:g,keyExtractor:r=>r.id,animateIn:!0,editable:{getValue:r=>r.title},renderItem:r=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:I.title,children:r.title}),e.jsxs("div",{className:I.meta,children:[r.subtitle&&e.jsx("span",{className:I.subtitle,children:r.subtitle}),r.createdAt&&e.jsx("span",{className:I.time,children:new Date(r.createdAt).toLocaleString()})]})]}),actions:[{label:"继续编辑",onClick:r=>_(r.id),className:ce.btnEdit},{label:"重命名",isRename:!0,onClick:(r,M)=>M&&$(r.id,M),className:ce.btnRename},{label:"删除",onClick:r=>{l(r.id),p(r.title||"未命名试卷")},className:ce.btnDanger}],emptyText:"暂无试卷。"})})]})})})}),e.jsx(ve,{visible:S,title:"新建试卷",onClose:()=>w(!1),children:e.jsxs("div",{children:[e.jsx("p",{style:{color:"#666"},children:"填写试卷基本信息以便快速生成试卷初稿。"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(Le,{fields:[{name:"name",label:"试卷标题",placeholder:"例如： 期末考试 2025",defaultValue:"未命名试卷"},{name:"content",label:"考察内容",type:"textarea",placeholder:"例如： 操作系统、数据库",rows:6},{name:"materials",label:"相关资料",type:"file",multiple:!0,accept:".pdf,.docx,.pptx"},{name:"difficulty",label:"难度预设比例",defaultValue:{easy:30,medium:50,hard:20},render:(r,M)=>e.jsx(v,{value:r,onChange:M})},{name:"choose_count",label:"选择",type:"number",defaultValue:10},{name:"short_count",label:"简答",type:"number",defaultValue:4},{name:"fill_count",label:"填空",type:"number",defaultValue:0},{name:"program_count",label:"编程",type:"number",defaultValue:0},{name:"essay_count",label:"论述",type:"number",defaultValue:0}],submitText:"生成初稿",submitLoading:B,submitLoadingText:"生成中",submitDisabled:B,onSubmit:r=>{B||(N(!0),setTimeout(()=>{L(r),w(!1),N(!1)},600))}})})]})}),e.jsx(fe,{open:!!A,title:"删除试卷",description:`确认删除「${h}」吗？此操作不可恢复。`,confirmText:"确认删除",danger:!0,onCancel:()=>{l(null),p("")},onConfirm:()=>{A&&E(A),l(null),p("")}})]})},Qe="_headerRow_lg0un_2",Je="_headerCard_lg0un_11",Ke="_titleInputLarge_lg0un_51",Ge="_rightAction_lg0un_87",Xe="_scoreBox_lg0un_101",Ye="_scoreLabel_lg0un_110",ze="_scoreValue_lg0un_115",Ue="_backBtn_lg0un_121",Ze="_previewBtn_lg0un_122",es="_layout_lg0un_149",ss="_rightPane_lg0un_156",ts="_aiCard_lg0un_160",ns="_paperArea_lg0un_174",as="_paperCard_lg0un_180",ls="_paperHeader_lg0un_190",is="_paperBody_lg0un_196",rs="_questionStack_lg0un_202",os="_questionCard_lg0un_208",cs="_selectedCard_lg0un_228",ds="_draggingCard_lg0un_233",us="_cardHeader_lg0un_238",ms="_cardIndex_lg0un_245",gs="_cardMeta_lg0un_250",hs="_dragHandle_lg0un_265",xs="_cardStem_lg0un_271",_s="_cardFooter_lg0un_277",ps="_cardActions_lg0un_293",vs="_card_lg0un_238",fs="_qualityCard_lg0un_307",js="_panelWrap_lg0un_315",ys="_recommendOverlay_lg0un_321",bs="_recommendHidden_lg0un_337",Ns="_recommendWrap_lg0un_343",Cs="_structureCard_lg0un_352",ws="_structureHeader_lg0un_359",Bs="_structureBody_lg0un_367",Ss="_structureRow_lg0un_373",Ts="_structureLabel_lg0un_379",ks="_structureValue_lg0un_385",Rs="_knowledgeTags_lg0un_391",Ds="_knowledgeTag_lg0un_391",Ls="_knowledgeEmpty_lg0un_405",Es="_dialogCard_lg0un_410",Ms="_dialogBody_lg0un_418",Is="_modalDialogCard_lg0un_425",As="_modalDialogBody_lg0un_431",$s="_previewModal_lg0un_438",Hs="_qualitySummary_lg0un_444",Ps="_qualityBox_lg0un_448",Vs="_qualityHint_lg0un_457",Os="_qualityResult_lg0un_462",Ws="_qualityStatus_lg0un_467",qs="_qualityAdvice_lg0un_473",Fs="_coverageRow_lg0un_479",Qs="_coverageLabel_lg0un_485",Js="_coverageBarWrap_lg0un_490",Ks="_coverageBar_lg0un_490",Gs="_coverageFill_lg0un_501",Xs="_coveragePercent_lg0un_507",Ys="_difficultyRow_lg0un_514",zs="_diffPercents_lg0un_522",Us="_metricsRow_lg0un_530",Zs="_metric_lg0un_530",et="_metricLabel_lg0un_543",st="_metricValue_lg0un_548",tt="_metricText_lg0un_554",nt="_recommendCard_lg0un_560",at="_switchBtn_lg0un_568",lt="_recommendList_lg0un_588",it="_recItem_lg0un_595",rt="_recHeader_lg0un_604",ot="_recTags_lg0un_610",ct="_recTag_lg0un_610",dt="_recStem_lg0un_624",ut="_recReplaceBtn_lg0un_630",mt="_cardTitle_lg0un_647",gt="_cardBody_lg0un_652",ht="_empty_lg0un_656",xt="_scoreInput_lg0un_698",_t="_modifyBtn_lg0un_705",pt="_deleteBtn_lg0un_721",vt="_insertWrap_lg0un_737",ft="_insertBtn_lg0un_743",jt="_optionsList_lg0un_759",yt="_optionItem_lg0un_765",bt="_modalOverlay_lg0un_783",Nt="_modalContent_lg0un_796",Ct="_modalColumns_lg0un_805",wt="_modalActions_lg0un_810",Bt="_modalCloseBtn_lg0un_817",St="_generateBtn_lg0un_833",Tt="_confirmBtn_lg0un_849",kt="_analysisWrap_lg0un_865",Rt="_analysisBox_lg0un_873",Dt="_analysisTitle_lg0un_881",Lt="_analysisContent_lg0un_887",t={headerRow:Qe,headerCard:Je,titleInputLarge:Ke,rightAction:Ge,scoreBox:Xe,scoreLabel:Ye,scoreValue:ze,backBtn:Ue,previewBtn:Ze,layout:es,rightPane:ss,aiCard:ts,paperArea:ns,paperCard:as,paperHeader:ls,paperBody:is,questionStack:rs,questionCard:os,selectedCard:cs,draggingCard:ds,cardHeader:us,cardIndex:ms,cardMeta:gs,dragHandle:hs,cardStem:xs,cardFooter:_s,cardActions:ps,card:vs,qualityCard:fs,panelWrap:js,recommendOverlay:ys,recommendHidden:bs,recommendWrap:Ns,structureCard:Cs,structureHeader:ws,structureBody:Bs,structureRow:Ss,structureLabel:Ts,structureValue:ks,knowledgeTags:Rs,knowledgeTag:Ds,knowledgeEmpty:Ls,dialogCard:Es,dialogBody:Ms,modalDialogCard:Is,modalDialogBody:As,previewModal:$s,qualitySummary:Hs,qualityBox:Ps,qualityHint:Vs,qualityResult:Os,qualityStatus:Ws,qualityAdvice:qs,coverageRow:Fs,coverageLabel:Qs,coverageBarWrap:Js,coverageBar:Ks,coverageFill:Gs,coveragePercent:Xs,difficultyRow:Ys,diffPercents:zs,metricsRow:Us,metric:Zs,metricLabel:et,metricValue:st,metricText:tt,recommendCard:nt,switchBtn:at,recommendList:lt,recItem:it,recHeader:rt,recTags:ot,recTag:ct,recStem:dt,recReplaceBtn:ut,cardTitle:mt,cardBody:gt,empty:ht,scoreInput:xt,modifyBtn:_t,deleteBtn:pt,insertWrap:vt,insertBtn:ft,optionsList:jt,optionItem:yt,modalOverlay:bt,modalContent:Nt,modalColumns:Ct,modalActions:wt,modalCloseBtn:Bt,generateBtn:St,confirmBtn:Tt,analysisWrap:kt,analysisBox:Rt,analysisTitle:Dt,analysisContent:Lt},Et=({examId:g="default-exam",title:_="未命名试卷",questions:L=[],onBack:E})=>{const $="exam_design_exams_v1",S=()=>{try{const s=localStorage.getItem($);return s?JSON.parse(s):[]}catch(s){return console.warn("loadExams failed",s),[]}},w=s=>{try{localStorage.setItem($,JSON.stringify(s))}catch(n){console.warn("saveExams failed",n)}},B=(s,n)=>{try{const a=S(),c=a.findIndex(D=>D.id===g),y={id:g,title:n??N??_??"未命名试卷",createdAt:Date.now(),questions:s};c>=0?a[c]={...a[c],title:y.title,questions:s}:a.push(y),w(a)}catch(a){console.warn("persistExam failed",a)}},[N,A]=i.useState(_),[l,h]=i.useState(null),[p,v]=i.useState(null),[r,M]=i.useState(!1),[O,x]=i.useState(!1),[W,f]=i.useState(!1),[C,H]=i.useState(null),T=s=>s?`${g}-q-${s}`:g;i.useEffect(()=>{let n;return l?(x(!0),f(!1),requestAnimationFrame(()=>f(!0))):(f(!1),n=window.setTimeout(()=>x(!1),320)),()=>{n&&window.clearTimeout(n)}},[l]);const k=s=>H(s),[u,R]=i.useState(L);i.useEffect(()=>R(L),[L]),i.useEffect(()=>{const s=S(),n=s.find(a=>a.id===g);if(n)R(n.questions||[]),A(n.title||_);else{const a={id:g,title:_||"未命名试卷",createdAt:Date.now(),questions:L};s.push(a),w(s)}},[]),i.useEffect(()=>{const s=S(),n=s.findIndex(c=>c.id===g),a={id:g,title:N||_||"未命名试卷",createdAt:Date.now(),questions:u};n>=0?s[n]={...s[n],title:a.title,questions:a.questions}:s.push(a),w(s)},[u,N,g,_]);const[o,m]=i.useState(!1),[d,b]=i.useState(null),[j,Q]=i.useState(null),[Z,J]=i.useState(""),[ue,me]=i.useState(5),[P,ee]=i.useState(""),[q,se]=i.useState("简答"),[te,ne]=i.useState("中等"),[ae,le]=i.useState("理解"),[F,V]=i.useState([]),[ie,re]=i.useState("");i.useEffect(()=>{if(o)if(j){const s=u.find(n=>n.id===j);J(s?.stem||""),me(s?.score??5),ee(s?.knowledge||""),se(s?.type||"简答"),ne(s?.difficulty||"中等"),le(s?.cognition||"理解"),V(s?.options&&s.options.length?s.options.slice():["",""]),re(s?.answerAnalysis||"")}else J(""),me(5),ee(""),se("简答"),ne("中等"),le("理解"),V(["",""]),re("")},[o,j,u]);const je=()=>{const s={id:Date.now().toString(),stem:Z,score:ue,type:q,options:F&&F.length?F.map(a=>a.trim()).filter(Boolean):void 0,knowledge:P,difficulty:te,cognition:ae,answerAnalysis:ie};let n;if(j)n=u.map(a=>a.id===j?{...a,stem:Z,score:ue,type:q,options:s.options,knowledge:P,difficulty:te,cognition:ae,answerAnalysis:ie}:a);else if(d==null)n=[...u,s];else{const a=Math.max(0,Math.min(d+1,u.length)),c=[...u];c.splice(a,0,s),n=c}R(n),B(n),m(!1),Q(null),b(null)},K=u.map((s,n)=>({id:s.id,index:n+1,stem:s.stem,score:s.score??0,options:s.options??[]})),ge=K.reduce((s,n)=>s+n.score,0),ye=u.reduce((s,n)=>{const a=n.type||"未标注";return s[a]=(s[a]||0)+1,s},{}),be=u.reduce((s,n)=>{const a=n.difficulty||"未标注";return s[a]=(s[a]||0)+1,s},{}),Ne=u.reduce((s,n)=>{const a=n.knowledge||"未标注";return s[a]=(s[a]||0)+1,s},{}),he=s=>{const n=Object.entries(s);return n.length===0?"暂无题目":n.map(([a,c])=>`${a} ×${c}`).join(" / ")},xe=Object.entries(Ne),G=(()=>{const n=[`# ${N||_||"未命名试卷"}`,"",`- 题量：${K.length}`,`- 总分：${ge}`,""];return K.length===0?(n.push("暂无题目。"),n.join(`
`)):(K.forEach(a=>{const c=a.score?`（${a.score}分）`:"";n.push(`## ${a.index}. ${a.stem}${c}`),a.options.length>0&&(n.push(""),a.options.forEach((y,D)=>{n.push(`- ${String.fromCharCode(65+D)}. ${y}`)})),n.push("")}),n.join(`
`).trim())})(),Ce=s=>n=>{n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",s),v(s)},we=()=>{v(null)},Be=s=>{s.preventDefault()},Se=s=>n=>{n.preventDefault();const a=n.dataTransfer.getData("text/plain");!a||a===s||(R(c=>{const y=c.findIndex(oe=>oe.id===a),D=c.findIndex(oe=>oe.id===s);if(y<0||D<0)return c;const Y=[...c],[De]=Y.splice(y,1);return Y.splice(D,0,De),B(Y),Y}),v(null))},X=[{id:"r1",tags:["数据结构","困难","选择"],stem:"红黑树中，红色节点的子节点必须是？"},{id:"r2",tags:["数据结构","简单","选择"],stem:"栈的特点是？"}],Te=[{id:"r3",tags:["算法","中等","填空"],stem:"二分查找的前提是什么？"},{id:"r4",tags:["数据库","简单","选择"],stem:"SQL 中用于筛选的关键字是？"}],[ke,Re]=i.useState(X);return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(Ee,{}),e.jsx(_e,{title:"试卷设计"}),e.jsxs("div",{className:pe.content,children:[e.jsx("div",{className:t.headerCard,children:e.jsxs("div",{className:t.headerRow,children:[e.jsx("input",{className:t.titleInputLarge,type:"text",value:N,onChange:s=>A(s.target.value),placeholder:"未命名试卷"}),e.jsxs("div",{className:t.rightAction,children:[e.jsxs("div",{className:t.scoreBox,children:[e.jsx("div",{className:t.scoreLabel,children:"总分"}),e.jsx("div",{className:t.scoreValue,children:ge})]}),e.jsx("button",{className:t.backBtn,onClick:E,children:"返回试卷列表"}),e.jsx("button",{className:t.previewBtn,onClick:()=>M(!0),children:"试卷预览"}),e.jsx(Ie,{button:"导出",items:[{label:"导出 PDF",onClick:()=>Ae(N||_||"exam",G)},{label:"导出 Docx",onClick:()=>$e(N||_||"exam",G)},{label:"导出 Markdown",onClick:()=>He(N||_||"exam",G)}]})]})]})}),e.jsxs("div",{className:t.layout,children:[e.jsx("div",{className:t.leftPane,children:e.jsx("div",{className:t.paperArea,children:e.jsxs("div",{className:t.paperCard,children:[e.jsx("div",{className:t.paperHeader,children:"试卷"}),e.jsxs("div",{className:t.paperBody,children:[u.length===0&&e.jsx("div",{className:t.empty,children:"当前试卷暂无题目"}),u.map((s,n)=>e.jsxs("div",{className:t.questionStack,children:[e.jsxs("div",{className:`${t.questionCard} ${l===s.id?t.selectedCard:""} ${p===s.id?t.draggingCard:""}`,onClick:()=>h(a=>a===s.id?null:s.id),role:"button",tabIndex:0,draggable:!0,onDragStart:Ce(s.id),onDragEnd:we,onDragOver:Be,onDrop:Se(s.id),children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsxs("div",{className:t.cardIndex,children:["#",n+1]}),e.jsxs("div",{className:t.cardMeta,children:[e.jsx("span",{children:s.knowledge||"未标注"}),e.jsx("span",{children:s.difficulty||"中等"}),e.jsx("span",{children:s.type||"简答"})]}),e.jsx("span",{className:t.dragHandle,"aria-hidden":"true",children:"⋮⋮"})]}),e.jsxs("div",{className:t.cardStem,children:[s.stem,s.options&&s.options.length>0&&e.jsx("ul",{className:t.optionsList,children:s.options.map((a,c)=>e.jsxs("li",{className:t.optionItem,children:[String.fromCharCode(65+c),". ",a]},c))})]}),e.jsx("div",{className:t.cardFooter,onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:t.cardActions,children:[e.jsxs("label",{className:t.scoreLabel,children:["分值",e.jsx("input",{type:"number",value:s.score??5,onChange:a=>{const c=Number(a.target.value||0),y=u.map(D=>D.id===s.id?{...D,score:c}:D);R(y),B(y)},className:t.scoreInput})]}),e.jsx("button",{className:t.modifyBtn,onClick:()=>{Q(s.id),b(n-1),m(!0)},children:"修改"}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除题目",description:"确认删除该题目吗？此操作不可恢复。",confirmText:"确认删除",danger:!0,onConfirm:()=>{const a=u.filter(c=>c.id!==s.id);R(a),B(a),l===s.id&&h(null)}})},children:"删除"})]})})]}),l===s.id&&e.jsxs("div",{className:t.analysisWrap,children:[e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"知识点分析"}),e.jsx("div",{className:t.analysisContent,children:"当前题目覆盖「数据库」，建议搭配相邻知识点，扩展覆盖范围。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"难度分析"}),e.jsx("div",{className:t.analysisContent,children:"偏基础概念，适合作为入门或热身题。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"答案分析"}),e.jsx("div",{className:t.analysisContent,children:s.answerAnalysis||"暂无答案分析。"})]})]}),e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(n),Q(null),m(!0)},children:"+ 插入题目"})})]},s.id)),u.length===0&&e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(-1),Q(null),m(!0)},children:"+ 插入题目"})})]})]})})}),e.jsx("div",{className:t.rightPane,children:e.jsxs("div",{className:t.aiCard,children:[e.jsxs("div",{className:t.panelWrap,children:[e.jsxs("div",{className:t.qualityCard,children:[e.jsx("div",{className:t.cardTitle,children:"试卷质量画像"}),e.jsx("div",{className:t.qualitySummary,children:e.jsxs("div",{className:t.qualityBox,children:[e.jsx("div",{className:t.qualityHint,children:"综合评价"}),e.jsxs("div",{className:t.qualityResult,children:[e.jsx("div",{className:t.qualityStatus,children:"可用"}),e.jsx("div",{className:t.qualityAdvice})]})]})}),e.jsxs("div",{className:t.coverageRow,children:[e.jsx("div",{className:t.coverageLabel,children:"覆盖度"}),e.jsx("div",{className:t.coverageBarWrap,children:e.jsx("div",{className:t.coverageBar,children:e.jsx("div",{className:t.coverageFill,style:{width:"83%"}})})}),e.jsx("div",{className:t.coveragePercent,children:"83%"})]}),e.jsxs("div",{className:t.difficultyRow,children:[e.jsx("div",{className:t.diffLabel,children:"难度结构"}),e.jsx("div",{className:t.diffText,children:"合理"})]}),e.jsxs("div",{className:t.diffPercents,children:[e.jsx("div",{children:"易 30%"}),e.jsx("div",{children:"中 50%"}),e.jsx("div",{children:"难 20%"})]}),e.jsxs("div",{className:t.metricsRow,children:[e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"区分度"}),e.jsx("div",{className:t.metricValue,children:"0.42"}),e.jsx("div",{className:t.metricText,children:"良好"})]}),e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"信度"}),e.jsx("div",{className:t.metricValue,children:"0.78"}),e.jsx("div",{className:t.metricText,children:"可接受"})]})]})]}),e.jsxs("div",{className:t.structureCard,children:[e.jsx("div",{className:t.structureHeader,children:e.jsx("div",{className:t.cardTitle,children:"试卷概览"})}),e.jsxs("div",{className:t.structureBody,children:[e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"题型分布"}),e.jsx("div",{className:t.structureValue,children:he(ye)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"难度分布"}),e.jsx("div",{className:t.structureValue,children:he(be)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"知识点覆盖"}),e.jsx("div",{className:t.knowledgeTags,children:xe.length?xe.map(([s,n])=>e.jsxs("span",{className:t.knowledgeTag,children:[s," ×",n]},s)):e.jsx("span",{className:t.knowledgeEmpty,children:"暂无"})})]})]})]})]}),O&&e.jsx("div",{className:`${t.recommendOverlay} ${W?"":t.recommendHidden}`,children:e.jsxs("div",{className:t.recommendWrap,children:[e.jsxs("div",{className:t.recommendCard,children:[e.jsx("div",{className:t.cardTitle,children:"推荐变题"}),e.jsx("button",{className:t.switchBtn,onClick:()=>{Re(s=>s===X||s[0]?.id===X[0].id?Te:X)},children:"换一换"}),e.jsx("div",{className:t.recommendList,children:ke.map(s=>e.jsxs("div",{className:t.recItem,children:[e.jsxs("div",{className:t.recHeader,children:[e.jsx("div",{className:t.recTags,children:s.tags.map(n=>e.jsx("span",{className:t.recTag,children:n},n))}),e.jsx("button",{className:t.recReplaceBtn,onClick:()=>{const n=u.map(a=>a.id===l?{...a,stem:s.stem}:a);R(n),B(n)},children:"替换"})]}),e.jsx("div",{className:t.recStem,children:s.stem})]},s.id))})]}),e.jsx("div",{className:`${t.card} ${t.dialogCard}`,children:e.jsx("div",{className:t.dialogBody,children:e.jsx(U,{dialogId:T(l),botName:"题目助手",initMessage:"这是本题的讨论对话。"})})})]})})]})})]})]}),o&&e.jsx("div",{className:t.modalOverlay,onClick:()=>m(!1),children:e.jsxs("div",{className:t.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:t.modalColumns,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{marginTop:0},children:j?"修改题目":"生成插入题目"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{marginBottom:6},children:"题干"}),e.jsx("textarea",{value:Z,onChange:s=>J(s.target.value),rows:5,style:{width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"知识点"}),e.jsx("input",{value:P,onChange:s=>ee(s.target.value),placeholder:"例如：数据库",style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"题型"}),e.jsxs("select",{value:q,onChange:s=>{const n=s.target.value;se(n),n==="选择"&&F.length<2&&V(["",""])},style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简答"}),e.jsx("option",{children:"选择"}),e.jsx("option",{children:"填空"}),e.jsx("option",{children:"编程"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"难度"}),e.jsxs("select",{value:te,onChange:s=>ne(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简单"}),e.jsx("option",{children:"中等"}),e.jsx("option",{children:"困难"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"认知层次"}),e.jsxs("select",{value:ae,onChange:s=>le(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"记忆"}),e.jsx("option",{children:"理解"}),e.jsx("option",{children:"应用"}),e.jsx("option",{children:"分析"})]})]})]}),q==="选择"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"选项"}),F.map((s,n)=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsx("div",{style:{width:28,textAlign:"center",fontWeight:700},children:String.fromCharCode(65+n)}),e.jsx("input",{value:s,onChange:a=>V(c=>{const y=[...c];return y[n]=a.target.value,y}),placeholder:`选项 ${String.fromCharCode(65+n)}`,style:{flex:1,padding:8,borderRadius:8,border:"1px solid #eee"}}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除选项",description:"确认删除该选项吗？",confirmText:"确认删除",danger:!0,onConfirm:()=>{V(a=>a.length>1?a.filter((c,y)=>y!==n):a)}})},children:"删除"})]},n)),e.jsx("div",{children:e.jsx("button",{className:t.insertBtn,onClick:()=>V(s=>[...s,""]),children:"+ 添加选项"})})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"答案分析"}),e.jsx("textarea",{value:ie,onChange:s=>re(s.target.value),rows:3,style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]})]}),e.jsxs("div",{style:{width:360,marginLeft:16},children:[e.jsx("div",{className:t.cardTitle,children:"对话记录"}),e.jsx("div",{className:`${t.card} ${t.modalDialogCard}`,style:{marginTop:8},children:e.jsx("div",{className:`${t.cardBody} ${t.modalDialogBody}`,children:e.jsx(U,{dialogId:`${g}-gen`,botName:"生成助手",initMessage:"在此与模型对话以协助生成题目。"})})})]})]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{className:t.generateBtn,onClick:()=>{const n=`${P?`基于「${P}」`:""}${q}题：请描述 ${P||"相关"} 的核心概念。`;J(n)},children:"生成题目"}),e.jsx("button",{onClick:()=>{je()},className:t.confirmBtn,children:j?"保存修改":"确认加入"}),e.jsx("button",{onClick:()=>m(!1),className:t.modalCloseBtn,children:"取消"})]})]})}),e.jsx(fe,{open:!!C,title:C?.title,description:C?.description,confirmText:C?.confirmText,danger:C?.danger,onCancel:()=>H(null),onConfirm:()=>{C&&C.onConfirm(),H(null)}}),e.jsx(ve,{visible:r,title:"试卷预览",onClose:()=>M(!1),children:e.jsx("div",{className:t.previewModal,children:e.jsx(Pe,{value:G,showControls:!1})})})]})})},de="exam_design_exams_v1",$t=()=>{const[g,_]=i.useState([]),[L,E]=i.useState("list"),[$,S]=i.useState(null);i.useEffect(()=>{try{const l=localStorage.getItem(de);l&&_(JSON.parse(l))}catch(l){console.error("load exams",l)}},[]);const w=l=>{_(l);try{localStorage.setItem(de,JSON.stringify(l))}catch(h){console.error(h)}},B=l=>{const h=Date.now().toString(),p=l.name||"未命名试卷",r=[{id:h,title:p,questions:[],createdAt:Date.now()},...g];w(r),S(h),E("detail")},N=l=>{const h=g.filter(p=>p.id!==l);w(h);try{U.clearDialog(l);const p=g.find(v=>v.id===l);p&&p.questions.forEach(v=>U.clearDialog(`${l}-q-${v.id}`))}catch{}L==="detail"&&E("list"),$===l&&S(null)},A=l=>{if(!l)return;g.find(p=>p.id===l)&&(S(l),E("detail"))};if(L==="detail"){const l=g.find(h=>h.id===$)||g[0]||null;return e.jsx(Et,{examId:l?.id,title:l?.title,questions:l?.questions,onBack:()=>{try{const h=localStorage.getItem(de);h&&_(JSON.parse(h))}catch(h){console.error("load exams",h)}E("list"),S(null)}})}return e.jsx(Fe,{items:g.map(l=>({id:l.id,title:l.title,subtitle:"",createdAt:l.createdAt})),onEdit:l=>{l?A(l):E("detail")},onCreate:B,onDelete:l=>{l&&N(l)},onRename:(l,h)=>{const p=g.map(v=>v.id===l?{...v,title:h||v.title}:v);w(p)}})};export{$t as default};
