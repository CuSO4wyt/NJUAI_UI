import{r,j as e,F as Le,R as z,T as Ee}from"./index-B99eBySo.js";import{P as _e,s as pe}from"./style.module-DrJz4tgd.js";import{L as Me,l as ce,M as ve,C as fe,D as Ie,e as Ae,d as $e,b as He,c as U,a as Pe}from"./index-dGvTRTQ2.js";const Ve="_layout_1om69_35",Oe="_canvasCard_1om69_42",We="_canvasHeader_1om69_50",qe="_editBtn_1om69_62",I={layout:Ve,canvasCard:Oe,canvasHeader:We,editBtn:qe},Fe=({items:x,onEdit:_,onCreate:L,onDelete:E,onRename:$})=>{const[S,w]=r.useState(!1),[B,N]=r.useState(!1),[A,i]=r.useState(null),[g,p]=r.useState(""),v=({value:l,onChange:M})=>{const O=l||{easy:30,medium:50},[h,W]=r.useState(O.easy),[f,C]=r.useState(O.easy+O.medium),H=z.useRef(null),T=z.useRef(null);z.useEffect(()=>{const o=l||{easy:30,medium:50};W(o.easy),C(o.easy+o.medium)},[l]);const k=(o,u=0,d=100)=>Math.max(u,Math.min(d,o)),m=(o,u)=>{const d=Math.round(k(o,0,u)),b=Math.round(k(u-o,0,100-d)),j=100-d-b;M({easy:d,medium:b,hard:j})},R=o=>{const u=H.current;if(!u||!T.current)return;const d=u.getBoundingClientRect(),b=(o-d.left)/d.width*100;if(T.current==="p1"){const j=k(b,0,f-1);W(j),m(j,f)}else if(T.current==="p2"){const j=k(b,h+1,100);C(j),m(h,j)}};return z.useEffect(()=>{const o=b=>R(b.clientX),u=b=>R(b.touches[0].clientX),d=()=>{T.current=null};return window.addEventListener("mousemove",o),window.addEventListener("touchmove",u),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)}},[h,f]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx("div",{style:{padding:"6px 12px",borderRadius:8,background:"#fbf7ff"},children:e.jsxs("div",{ref:H,style:{height:12,background:"#f0e7ff",borderRadius:8,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:`${h}%`,background:"#6b2fb1",borderRadius:8}}),e.jsx("div",{style:{position:"absolute",left:`${h}%`,top:0,bottom:0,width:`${f-h}%`,background:"#b080ff"}}),e.jsx("div",{style:{position:"absolute",left:`${f}%`,top:0,bottom:0,right:0,background:"#e9ddff",borderRadius:8}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(h),onMouseDown:o=>{o.preventDefault(),T.current="p1"},onTouchStart:()=>{T.current="p1"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${h}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(f),onMouseDown:o=>{o.preventDefault(),T.current="p2"},onTouchStart:()=>{T.current="p2"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${f}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}})]})}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("label",{style:{minWidth:60},children:"简单"}),e.jsx("input",{type:"number",value:Math.round(h),onChange:o=>{const u=Number(o.target.value||0),d=k(u,0,f-1);W(d),m(d,f)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"中等"}),e.jsx("input",{type:"number",value:Math.round(f-h),onChange:o=>{const u=Number(o.target.value||0),d=k(h+u,h+1,100);C(d),m(h,d)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"困难"}),e.jsx("input",{type:"number",value:Math.round(100-f),onChange:o=>{const u=Number(o.target.value||0),d=k(100-u,h+1,100);C(d),m(h,d)},style:{width:72}})]})]})};return e.jsxs("div",{children:[e.jsx(_e,{title:"试卷设计"}),e.jsx("div",{className:pe.content,children:e.jsx("div",{className:I.layout,children:e.jsx("div",{className:I.leftPane,children:e.jsxs("div",{className:I.canvasCard,children:[e.jsxs("div",{className:I.canvasHeader,children:[e.jsxs("div",{className:"titleLeft",children:["已创建的试卷 (",x.length,")"]}),e.jsx("div",{children:e.jsx("button",{className:I.editBtn,onClick:()=>w(!0),children:"新建试卷"})})]}),e.jsx("div",{style:{padding:12},children:e.jsx(Me,{items:x,keyExtractor:l=>l.id,editable:{getValue:l=>l.title},renderItem:l=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:I.title,children:l.title}),e.jsxs("div",{className:I.meta,children:[l.subtitle&&e.jsx("span",{className:I.subtitle,children:l.subtitle}),l.createdAt&&e.jsx("span",{className:I.time,children:new Date(l.createdAt).toLocaleString()})]})]}),actions:[{label:"继续编辑",onClick:l=>_(l.id),className:ce.btnEdit},{label:"重命名",isRename:!0,onClick:(l,M)=>M&&$(l.id,M),className:ce.btnRename},{label:"删除",onClick:l=>{i(l.id),p(l.title||"未命名试卷")},className:ce.btnDanger}],emptyText:"暂无试卷。"})})]})})})}),e.jsx(ve,{visible:S,title:"新建试卷",onClose:()=>w(!1),children:e.jsxs("div",{children:[e.jsx("p",{style:{color:"#666"},children:"填写试卷基本信息以便快速生成试卷初稿。"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(Le,{fields:[{name:"name",label:"试卷标题",placeholder:"例如： 期末考试 2025",defaultValue:"未命名试卷"},{name:"content",label:"考察内容",type:"textarea",placeholder:"例如： 操作系统、数据库",rows:6},{name:"materials",label:"相关资料",type:"file",multiple:!0,accept:".pdf,.docx,.pptx"},{name:"difficulty",label:"难度预设比例",defaultValue:{easy:30,medium:50,hard:20},render:(l,M)=>e.jsx(v,{value:l,onChange:M})},{name:"choose_count",label:"选择",type:"number",defaultValue:10},{name:"short_count",label:"简答",type:"number",defaultValue:4},{name:"fill_count",label:"填空",type:"number",defaultValue:0},{name:"program_count",label:"编程",type:"number",defaultValue:0},{name:"essay_count",label:"论述",type:"number",defaultValue:0}],submitText:"生成初稿",submitLoading:B,submitLoadingText:"生成中",submitDisabled:B,onSubmit:l=>{B||(N(!0),setTimeout(()=>{L(l),w(!1),N(!1)},600))}})})]})}),e.jsx(fe,{open:!!A,title:"删除试卷",description:`确认删除「${g}」吗？此操作不可恢复。`,confirmText:"确认删除",danger:!0,onCancel:()=>{i(null),p("")},onConfirm:()=>{A&&E(A),i(null),p("")}})]})},Qe="_headerRow_gsexn_2",Je="_headerCard_gsexn_11",Ke="_titleInputLarge_gsexn_51",Ge="_rightAction_gsexn_87",Xe="_scoreBox_gsexn_96",Ye="_scoreLabel_gsexn_104",ze="_scoreValue_gsexn_109",Ue="_backBtn_gsexn_115",Ze="_previewBtn_gsexn_116",es="_layout_gsexn_137",ss="_rightPane_gsexn_144",ts="_aiCard_gsexn_148",ns="_paperArea_gsexn_162",as="_paperCard_gsexn_168",is="_paperHeader_gsexn_178",rs="_paperBody_gsexn_184",ls="_questionStack_gsexn_190",os="_questionCard_gsexn_196",cs="_selectedCard_gsexn_216",ds="_draggingCard_gsexn_221",ms="_cardHeader_gsexn_226",us="_cardIndex_gsexn_233",xs="_cardMeta_gsexn_238",gs="_dragHandle_gsexn_253",hs="_cardStem_gsexn_259",_s="_cardFooter_gsexn_265",ps="_cardActions_gsexn_281",vs="_card_gsexn_226",fs="_qualityCard_gsexn_295",js="_panelWrap_gsexn_303",ys="_recommendOverlay_gsexn_309",bs="_recommendHidden_gsexn_325",Ns="_recommendWrap_gsexn_331",Cs="_structureCard_gsexn_340",ws="_structureHeader_gsexn_347",Bs="_structureBody_gsexn_355",Ss="_structureRow_gsexn_361",Ts="_structureLabel_gsexn_367",ks="_structureValue_gsexn_373",Rs="_knowledgeTags_gsexn_379",Ds="_knowledgeTag_gsexn_379",Ls="_knowledgeEmpty_gsexn_393",Es="_dialogCard_gsexn_398",Ms="_dialogBody_gsexn_406",Is="_modalDialogCard_gsexn_413",As="_modalDialogBody_gsexn_419",$s="_previewModal_gsexn_426",Hs="_qualitySummary_gsexn_432",Ps="_qualityBox_gsexn_436",Vs="_qualityHint_gsexn_445",Os="_qualityResult_gsexn_450",Ws="_qualityStatus_gsexn_455",qs="_qualityAdvice_gsexn_461",Fs="_coverageRow_gsexn_467",Qs="_coverageLabel_gsexn_473",Js="_coverageBarWrap_gsexn_478",Ks="_coverageBar_gsexn_478",Gs="_coverageFill_gsexn_489",Xs="_coveragePercent_gsexn_495",Ys="_difficultyRow_gsexn_502",zs="_diffPercents_gsexn_510",Us="_metricsRow_gsexn_518",Zs="_metric_gsexn_518",et="_metricLabel_gsexn_531",st="_metricValue_gsexn_536",tt="_metricText_gsexn_542",nt="_recommendCard_gsexn_548",at="_switchBtn_gsexn_556",it="_recommendList_gsexn_576",rt="_recItem_gsexn_583",lt="_recHeader_gsexn_592",ot="_recTags_gsexn_598",ct="_recTag_gsexn_598",dt="_recStem_gsexn_612",mt="_recReplaceBtn_gsexn_618",ut="_cardTitle_gsexn_635",xt="_cardBody_gsexn_640",gt="_empty_gsexn_644",ht="_scoreInput_gsexn_686",_t="_modifyBtn_gsexn_693",pt="_deleteBtn_gsexn_709",vt="_insertWrap_gsexn_725",ft="_insertBtn_gsexn_731",jt="_optionsList_gsexn_747",yt="_optionItem_gsexn_753",bt="_modalOverlay_gsexn_771",Nt="_modalContent_gsexn_784",Ct="_modalColumns_gsexn_793",wt="_modalActions_gsexn_798",Bt="_modalCloseBtn_gsexn_805",St="_generateBtn_gsexn_821",Tt="_confirmBtn_gsexn_837",kt="_analysisWrap_gsexn_853",Rt="_analysisBox_gsexn_861",Dt="_analysisTitle_gsexn_869",Lt="_analysisContent_gsexn_875",t={headerRow:Qe,headerCard:Je,titleInputLarge:Ke,rightAction:Ge,scoreBox:Xe,scoreLabel:Ye,scoreValue:ze,backBtn:Ue,previewBtn:Ze,layout:es,rightPane:ss,aiCard:ts,paperArea:ns,paperCard:as,paperHeader:is,paperBody:rs,questionStack:ls,questionCard:os,selectedCard:cs,draggingCard:ds,cardHeader:ms,cardIndex:us,cardMeta:xs,dragHandle:gs,cardStem:hs,cardFooter:_s,cardActions:ps,card:vs,qualityCard:fs,panelWrap:js,recommendOverlay:ys,recommendHidden:bs,recommendWrap:Ns,structureCard:Cs,structureHeader:ws,structureBody:Bs,structureRow:Ss,structureLabel:Ts,structureValue:ks,knowledgeTags:Rs,knowledgeTag:Ds,knowledgeEmpty:Ls,dialogCard:Es,dialogBody:Ms,modalDialogCard:Is,modalDialogBody:As,previewModal:$s,qualitySummary:Hs,qualityBox:Ps,qualityHint:Vs,qualityResult:Os,qualityStatus:Ws,qualityAdvice:qs,coverageRow:Fs,coverageLabel:Qs,coverageBarWrap:Js,coverageBar:Ks,coverageFill:Gs,coveragePercent:Xs,difficultyRow:Ys,diffPercents:zs,metricsRow:Us,metric:Zs,metricLabel:et,metricValue:st,metricText:tt,recommendCard:nt,switchBtn:at,recommendList:it,recItem:rt,recHeader:lt,recTags:ot,recTag:ct,recStem:dt,recReplaceBtn:mt,cardTitle:ut,cardBody:xt,empty:gt,scoreInput:ht,modifyBtn:_t,deleteBtn:pt,insertWrap:vt,insertBtn:ft,optionsList:jt,optionItem:yt,modalOverlay:bt,modalContent:Nt,modalColumns:Ct,modalActions:wt,modalCloseBtn:Bt,generateBtn:St,confirmBtn:Tt,analysisWrap:kt,analysisBox:Rt,analysisTitle:Dt,analysisContent:Lt},Et=({examId:x="default-exam",title:_="未命名试卷",questions:L=[],onBack:E})=>{const $="exam_design_exams_v1",S=()=>{try{const s=localStorage.getItem($);return s?JSON.parse(s):[]}catch(s){return console.warn("loadExams failed",s),[]}},w=s=>{try{localStorage.setItem($,JSON.stringify(s))}catch(n){console.warn("saveExams failed",n)}},B=(s,n)=>{try{const a=S(),c=a.findIndex(D=>D.id===x),y={id:x,title:n??N??_??"未命名试卷",createdAt:Date.now(),questions:s};c>=0?a[c]={...a[c],title:y.title,questions:s}:a.push(y),w(a)}catch(a){console.warn("persistExam failed",a)}},[N,A]=r.useState(_),[i,g]=r.useState(null),[p,v]=r.useState(null),[l,M]=r.useState(!1),[O,h]=r.useState(!1),[W,f]=r.useState(!1),[C,H]=r.useState(null),T=s=>s?`${x}-q-${s}`:x;r.useEffect(()=>{let n;return i?(h(!0),f(!1),requestAnimationFrame(()=>f(!0))):(f(!1),n=window.setTimeout(()=>h(!1),320)),()=>{n&&window.clearTimeout(n)}},[i]);const k=s=>H(s),[m,R]=r.useState(L);r.useEffect(()=>R(L),[L]),r.useEffect(()=>{const s=S(),n=s.find(a=>a.id===x);if(n)R(n.questions||[]),A(n.title||_);else{const a={id:x,title:_||"未命名试卷",createdAt:Date.now(),questions:L};s.push(a),w(s)}},[]),r.useEffect(()=>{const s=S(),n=s.findIndex(c=>c.id===x),a={id:x,title:N||_||"未命名试卷",createdAt:Date.now(),questions:m};n>=0?s[n]={...s[n],title:a.title,questions:a.questions}:s.push(a),w(s)},[m,N,x,_]);const[o,u]=r.useState(!1),[d,b]=r.useState(null),[j,Q]=r.useState(null),[Z,J]=r.useState(""),[me,ue]=r.useState(5),[P,ee]=r.useState(""),[q,se]=r.useState("简答"),[te,ne]=r.useState("中等"),[ae,ie]=r.useState("理解"),[F,V]=r.useState([]),[re,le]=r.useState("");r.useEffect(()=>{if(o)if(j){const s=m.find(n=>n.id===j);J(s?.stem||""),ue(s?.score??5),ee(s?.knowledge||""),se(s?.type||"简答"),ne(s?.difficulty||"中等"),ie(s?.cognition||"理解"),V(s?.options&&s.options.length?s.options.slice():["",""]),le(s?.answerAnalysis||"")}else J(""),ue(5),ee(""),se("简答"),ne("中等"),ie("理解"),V(["",""]),le("")},[o,j,m]);const je=()=>{const s={id:Date.now().toString(),stem:Z,score:me,type:q,options:F&&F.length?F.map(a=>a.trim()).filter(Boolean):void 0,knowledge:P,difficulty:te,cognition:ae,answerAnalysis:re};let n;if(j)n=m.map(a=>a.id===j?{...a,stem:Z,score:me,type:q,options:s.options,knowledge:P,difficulty:te,cognition:ae,answerAnalysis:re}:a);else if(d==null)n=[...m,s];else{const a=Math.max(0,Math.min(d+1,m.length)),c=[...m];c.splice(a,0,s),n=c}R(n),B(n),u(!1),Q(null),b(null)},K=m.map((s,n)=>({id:s.id,index:n+1,stem:s.stem,score:s.score??0,options:s.options??[]})),xe=K.reduce((s,n)=>s+n.score,0),ye=m.reduce((s,n)=>{const a=n.type||"未标注";return s[a]=(s[a]||0)+1,s},{}),be=m.reduce((s,n)=>{const a=n.difficulty||"未标注";return s[a]=(s[a]||0)+1,s},{}),Ne=m.reduce((s,n)=>{const a=n.knowledge||"未标注";return s[a]=(s[a]||0)+1,s},{}),ge=s=>{const n=Object.entries(s);return n.length===0?"暂无题目":n.map(([a,c])=>`${a} ×${c}`).join(" / ")},he=Object.entries(Ne),G=(()=>{const n=[`# ${N||_||"未命名试卷"}`,"",`- 题量：${K.length}`,`- 总分：${xe}`,""];return K.length===0?(n.push("暂无题目。"),n.join(`
`)):(K.forEach(a=>{const c=a.score?`（${a.score}分）`:"";n.push(`## ${a.index}. ${a.stem}${c}`),a.options.length>0&&(n.push(""),a.options.forEach((y,D)=>{n.push(`- ${String.fromCharCode(65+D)}. ${y}`)})),n.push("")}),n.join(`
`).trim())})(),Ce=s=>n=>{n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",s),v(s)},we=()=>{v(null)},Be=s=>{s.preventDefault()},Se=s=>n=>{n.preventDefault();const a=n.dataTransfer.getData("text/plain");!a||a===s||(R(c=>{const y=c.findIndex(oe=>oe.id===a),D=c.findIndex(oe=>oe.id===s);if(y<0||D<0)return c;const Y=[...c],[De]=Y.splice(y,1);return Y.splice(D,0,De),B(Y),Y}),v(null))},X=[{id:"r1",tags:["数据结构","困难","选择"],stem:"红黑树中，红色节点的子节点必须是？"},{id:"r2",tags:["数据结构","简单","选择"],stem:"栈的特点是？"}],Te=[{id:"r3",tags:["算法","中等","填空"],stem:"二分查找的前提是什么？"},{id:"r4",tags:["数据库","简单","选择"],stem:"SQL 中用于筛选的关键字是？"}],[ke,Re]=r.useState(X);return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(Ee,{}),e.jsx(_e,{title:"试卷设计"}),e.jsxs("div",{className:pe.content,children:[e.jsx("div",{className:t.headerCard,children:e.jsxs("div",{className:t.headerRow,children:[e.jsx("input",{className:t.titleInputLarge,type:"text",value:N,onChange:s=>A(s.target.value),placeholder:"未命名试卷"}),e.jsxs("div",{className:t.rightAction,children:[e.jsxs("div",{className:t.scoreBox,children:[e.jsx("div",{className:t.scoreLabel,children:"总分"}),e.jsx("div",{className:t.scoreValue,children:xe})]}),e.jsx("button",{className:t.backBtn,onClick:E,children:"返回试卷列表"}),e.jsx("button",{className:t.previewBtn,onClick:()=>M(!0),children:"试卷预览"}),e.jsx(Ie,{button:"导出",items:[{label:"导出 PDF",onClick:()=>Ae(N||_||"exam",G)},{label:"导出 Docx",onClick:()=>$e(N||_||"exam",G)},{label:"导出 Markdown",onClick:()=>He(N||_||"exam",G)}]})]})]})}),e.jsxs("div",{className:t.layout,children:[e.jsx("div",{className:t.leftPane,children:e.jsx("div",{className:t.paperArea,children:e.jsxs("div",{className:t.paperCard,children:[e.jsx("div",{className:t.paperHeader,children:"试卷"}),e.jsxs("div",{className:t.paperBody,children:[m.length===0&&e.jsx("div",{className:t.empty,children:"当前试卷暂无题目"}),m.map((s,n)=>e.jsxs("div",{className:t.questionStack,children:[e.jsxs("div",{className:`${t.questionCard} ${i===s.id?t.selectedCard:""} ${p===s.id?t.draggingCard:""}`,onClick:()=>g(a=>a===s.id?null:s.id),role:"button",tabIndex:0,draggable:!0,onDragStart:Ce(s.id),onDragEnd:we,onDragOver:Be,onDrop:Se(s.id),children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsxs("div",{className:t.cardIndex,children:["#",n+1]}),e.jsxs("div",{className:t.cardMeta,children:[e.jsx("span",{children:s.knowledge||"未标注"}),e.jsx("span",{children:s.difficulty||"中等"}),e.jsx("span",{children:s.type||"简答"})]}),e.jsx("span",{className:t.dragHandle,"aria-hidden":"true",children:"⋮⋮"})]}),e.jsxs("div",{className:t.cardStem,children:[s.stem,s.options&&s.options.length>0&&e.jsx("ul",{className:t.optionsList,children:s.options.map((a,c)=>e.jsxs("li",{className:t.optionItem,children:[String.fromCharCode(65+c),". ",a]},c))})]}),e.jsx("div",{className:t.cardFooter,onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:t.cardActions,children:[e.jsxs("label",{className:t.scoreLabel,children:["分值",e.jsx("input",{type:"number",value:s.score??5,onChange:a=>{const c=Number(a.target.value||0),y=m.map(D=>D.id===s.id?{...D,score:c}:D);R(y),B(y)},className:t.scoreInput})]}),e.jsx("button",{className:t.modifyBtn,onClick:()=>{Q(s.id),b(n-1),u(!0)},children:"修改"}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除题目",description:"确认删除该题目吗？此操作不可恢复。",confirmText:"确认删除",danger:!0,onConfirm:()=>{const a=m.filter(c=>c.id!==s.id);R(a),B(a),i===s.id&&g(null)}})},children:"删除"})]})})]}),i===s.id&&e.jsxs("div",{className:t.analysisWrap,children:[e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"知识点分析"}),e.jsx("div",{className:t.analysisContent,children:"当前题目覆盖「数据库」，建议搭配相邻知识点，扩展覆盖范围。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"难度分析"}),e.jsx("div",{className:t.analysisContent,children:"偏基础概念，适合作为入门或热身题。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"答案分析"}),e.jsx("div",{className:t.analysisContent,children:s.answerAnalysis||"暂无答案分析。"})]})]}),e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(n),Q(null),u(!0)},children:"+ 插入题目"})})]},s.id)),m.length===0&&e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(-1),Q(null),u(!0)},children:"+ 插入题目"})})]})]})})}),e.jsx("div",{className:t.rightPane,children:e.jsxs("div",{className:t.aiCard,children:[e.jsxs("div",{className:t.panelWrap,children:[e.jsxs("div",{className:t.qualityCard,children:[e.jsx("div",{className:t.cardTitle,children:"试卷质量画像"}),e.jsx("div",{className:t.qualitySummary,children:e.jsxs("div",{className:t.qualityBox,children:[e.jsx("div",{className:t.qualityHint,children:"综合评价"}),e.jsxs("div",{className:t.qualityResult,children:[e.jsx("div",{className:t.qualityStatus,children:"可用"}),e.jsx("div",{className:t.qualityAdvice})]})]})}),e.jsxs("div",{className:t.coverageRow,children:[e.jsx("div",{className:t.coverageLabel,children:"覆盖度"}),e.jsx("div",{className:t.coverageBarWrap,children:e.jsx("div",{className:t.coverageBar,children:e.jsx("div",{className:t.coverageFill,style:{width:"83%"}})})}),e.jsx("div",{className:t.coveragePercent,children:"83%"})]}),e.jsxs("div",{className:t.difficultyRow,children:[e.jsx("div",{className:t.diffLabel,children:"难度结构"}),e.jsx("div",{className:t.diffText,children:"合理"})]}),e.jsxs("div",{className:t.diffPercents,children:[e.jsx("div",{children:"易 30%"}),e.jsx("div",{children:"中 50%"}),e.jsx("div",{children:"难 20%"})]}),e.jsxs("div",{className:t.metricsRow,children:[e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"区分度"}),e.jsx("div",{className:t.metricValue,children:"0.42"}),e.jsx("div",{className:t.metricText,children:"良好"})]}),e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"信度"}),e.jsx("div",{className:t.metricValue,children:"0.78"}),e.jsx("div",{className:t.metricText,children:"可接受"})]})]})]}),e.jsxs("div",{className:t.structureCard,children:[e.jsx("div",{className:t.structureHeader,children:e.jsx("div",{className:t.cardTitle,children:"试卷概览"})}),e.jsxs("div",{className:t.structureBody,children:[e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"题型分布"}),e.jsx("div",{className:t.structureValue,children:ge(ye)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"难度分布"}),e.jsx("div",{className:t.structureValue,children:ge(be)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"知识点覆盖"}),e.jsx("div",{className:t.knowledgeTags,children:he.length?he.map(([s,n])=>e.jsxs("span",{className:t.knowledgeTag,children:[s," ×",n]},s)):e.jsx("span",{className:t.knowledgeEmpty,children:"暂无"})})]})]})]})]}),O&&e.jsx("div",{className:`${t.recommendOverlay} ${W?"":t.recommendHidden}`,children:e.jsxs("div",{className:t.recommendWrap,children:[e.jsxs("div",{className:t.recommendCard,children:[e.jsx("div",{className:t.cardTitle,children:"推荐变题"}),e.jsx("button",{className:t.switchBtn,onClick:()=>{Re(s=>s===X||s[0]?.id===X[0].id?Te:X)},children:"换一换"}),e.jsx("div",{className:t.recommendList,children:ke.map(s=>e.jsxs("div",{className:t.recItem,children:[e.jsxs("div",{className:t.recHeader,children:[e.jsx("div",{className:t.recTags,children:s.tags.map(n=>e.jsx("span",{className:t.recTag,children:n},n))}),e.jsx("button",{className:t.recReplaceBtn,onClick:()=>{const n=m.map(a=>a.id===i?{...a,stem:s.stem}:a);R(n),B(n)},children:"替换"})]}),e.jsx("div",{className:t.recStem,children:s.stem})]},s.id))})]}),e.jsx("div",{className:`${t.card} ${t.dialogCard}`,children:e.jsx("div",{className:t.dialogBody,children:e.jsx(U,{dialogId:T(i),botName:"题目助手",initMessage:"这是本题的讨论对话。"})})})]})})]})})]})]}),o&&e.jsx("div",{className:t.modalOverlay,onClick:()=>u(!1),children:e.jsxs("div",{className:t.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:t.modalColumns,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{marginTop:0},children:j?"修改题目":"生成插入题目"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{marginBottom:6},children:"题干"}),e.jsx("textarea",{value:Z,onChange:s=>J(s.target.value),rows:5,style:{width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"知识点"}),e.jsx("input",{value:P,onChange:s=>ee(s.target.value),placeholder:"例如：数据库",style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"题型"}),e.jsxs("select",{value:q,onChange:s=>{const n=s.target.value;se(n),n==="选择"&&F.length<2&&V(["",""])},style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简答"}),e.jsx("option",{children:"选择"}),e.jsx("option",{children:"填空"}),e.jsx("option",{children:"编程"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"难度"}),e.jsxs("select",{value:te,onChange:s=>ne(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简单"}),e.jsx("option",{children:"中等"}),e.jsx("option",{children:"困难"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"认知层次"}),e.jsxs("select",{value:ae,onChange:s=>ie(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"记忆"}),e.jsx("option",{children:"理解"}),e.jsx("option",{children:"应用"}),e.jsx("option",{children:"分析"})]})]})]}),q==="选择"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"选项"}),F.map((s,n)=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsx("div",{style:{width:28,textAlign:"center",fontWeight:700},children:String.fromCharCode(65+n)}),e.jsx("input",{value:s,onChange:a=>V(c=>{const y=[...c];return y[n]=a.target.value,y}),placeholder:`选项 ${String.fromCharCode(65+n)}`,style:{flex:1,padding:8,borderRadius:8,border:"1px solid #eee"}}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除选项",description:"确认删除该选项吗？",confirmText:"确认删除",danger:!0,onConfirm:()=>{V(a=>a.length>1?a.filter((c,y)=>y!==n):a)}})},children:"删除"})]},n)),e.jsx("div",{children:e.jsx("button",{className:t.insertBtn,onClick:()=>V(s=>[...s,""]),children:"+ 添加选项"})})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"答案分析"}),e.jsx("textarea",{value:re,onChange:s=>le(s.target.value),rows:3,style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]})]}),e.jsxs("div",{style:{width:360,marginLeft:16},children:[e.jsx("div",{className:t.cardTitle,children:"对话记录"}),e.jsx("div",{className:`${t.card} ${t.modalDialogCard}`,style:{marginTop:8},children:e.jsx("div",{className:`${t.cardBody} ${t.modalDialogBody}`,children:e.jsx(U,{dialogId:`${x}-gen`,botName:"生成助手",initMessage:"在此与模型对话以协助生成题目。"})})})]})]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{className:t.generateBtn,onClick:()=>{const n=`${P?`基于「${P}」`:""}${q}题：请描述 ${P||"相关"} 的核心概念。`;J(n)},children:"生成题目"}),e.jsx("button",{onClick:()=>{je()},className:t.confirmBtn,children:j?"保存修改":"确认加入"}),e.jsx("button",{onClick:()=>u(!1),className:t.modalCloseBtn,children:"取消"})]})]})}),e.jsx(fe,{open:!!C,title:C?.title,description:C?.description,confirmText:C?.confirmText,danger:C?.danger,onCancel:()=>H(null),onConfirm:()=>{C&&C.onConfirm(),H(null)}}),e.jsx(ve,{visible:l,title:"试卷预览",onClose:()=>M(!1),children:e.jsx("div",{className:t.previewModal,children:e.jsx(Pe,{value:G,showControls:!1})})})]})})},de="exam_design_exams_v1",$t=()=>{const[x,_]=r.useState([]),[L,E]=r.useState("list"),[$,S]=r.useState(null);r.useEffect(()=>{try{const i=localStorage.getItem(de);i&&_(JSON.parse(i))}catch(i){console.error("load exams",i)}},[]);const w=i=>{_(i);try{localStorage.setItem(de,JSON.stringify(i))}catch(g){console.error(g)}},B=i=>{const g=Date.now().toString(),p=i.name||"未命名试卷",l=[{id:g,title:p,questions:[],createdAt:Date.now()},...x];w(l),S(g),E("detail")},N=i=>{const g=x.filter(p=>p.id!==i);w(g);try{U.clearDialog(i);const p=x.find(v=>v.id===i);p&&p.questions.forEach(v=>U.clearDialog(`${i}-q-${v.id}`))}catch{}L==="detail"&&E("list"),$===i&&S(null)},A=i=>{if(!i)return;x.find(p=>p.id===i)&&(S(i),E("detail"))};if(L==="detail"){const i=x.find(g=>g.id===$)||x[0]||null;return e.jsx(Et,{examId:i?.id,title:i?.title,questions:i?.questions,onBack:()=>{try{const g=localStorage.getItem(de);g&&_(JSON.parse(g))}catch(g){console.error("load exams",g)}E("list"),S(null)}})}return e.jsx(Fe,{items:x.map(i=>({id:i.id,title:i.title,subtitle:"",createdAt:i.createdAt})),onEdit:i=>{i?A(i):E("detail")},onCreate:B,onDelete:i=>{i&&N(i)},onRename:(i,g)=>{const p=x.map(v=>v.id===i?{...v,title:g||v.title}:v);w(p)}})};export{$t as default};
