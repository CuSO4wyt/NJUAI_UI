import{r as i,j as e,F as Le,R as z,T as Ee}from"./index-DqMs9835.js";import{P as pe,s as ge}from"./style.module-C3sq6iEW.js";import{L as Me,l as ce,M as ve,C as fe,D as Ie,e as Ae,d as $e,b as He,c as U,a as Pe}from"./index-DGQ8sSXk.js";const Ve="_layout_1om69_35",Oe="_canvasCard_1om69_42",We="_canvasHeader_1om69_50",qe="_editBtn_1om69_62",I={layout:Ve,canvasCard:Oe,canvasHeader:We,editBtn:qe},Fe=({items:h,onEdit:p,onCreate:L,onDelete:E,onRename:$})=>{const[S,w]=i.useState(!1),[B,N]=i.useState(!1),[A,r]=i.useState(null),[x,g]=i.useState(""),v=({value:l,onChange:M})=>{const O=l||{easy:30,medium:50},[_,W]=i.useState(O.easy),[f,C]=i.useState(O.easy+O.medium),H=z.useRef(null),T=z.useRef(null);z.useEffect(()=>{const o=l||{easy:30,medium:50};W(o.easy),C(o.easy+o.medium)},[l]);const k=(o,u=0,d=100)=>Math.max(u,Math.min(d,o)),m=(o,u)=>{const d=Math.round(k(o,0,u)),b=Math.round(k(u-o,0,100-d)),j=100-d-b;M({easy:d,medium:b,hard:j})},R=o=>{const u=H.current;if(!u||!T.current)return;const d=u.getBoundingClientRect(),b=(o-d.left)/d.width*100;if(T.current==="p1"){const j=k(b,0,f-1);W(j),m(j,f)}else if(T.current==="p2"){const j=k(b,_+1,100);C(j),m(_,j)}};return z.useEffect(()=>{const o=b=>R(b.clientX),u=b=>R(b.touches[0].clientX),d=()=>{T.current=null};return window.addEventListener("mousemove",o),window.addEventListener("touchmove",u),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)}},[_,f]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx("div",{style:{padding:"6px 12px",borderRadius:8,background:"#fbf7ff"},children:e.jsxs("div",{ref:H,style:{height:12,background:"#f0e7ff",borderRadius:8,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:`${_}%`,background:"#6b2fb1",borderRadius:8}}),e.jsx("div",{style:{position:"absolute",left:`${_}%`,top:0,bottom:0,width:`${f-_}%`,background:"#b080ff"}}),e.jsx("div",{style:{position:"absolute",left:`${f}%`,top:0,bottom:0,right:0,background:"#e9ddff",borderRadius:8}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(_),onMouseDown:o=>{o.preventDefault(),T.current="p1"},onTouchStart:()=>{T.current="p1"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${_}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}}),e.jsx("div",{role:"slider","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(f),onMouseDown:o=>{o.preventDefault(),T.current="p2"},onTouchStart:()=>{T.current="p2"},style:{position:"absolute",top:"50%",transform:"translate(-50%,-50%)",left:`${f}%`,width:18,height:18,borderRadius:9,background:"#fff",border:"4px solid #6b2fb1",boxShadow:"0 4px 12px rgba(0,0,0,0.12)",cursor:"grab"}})]})}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("label",{style:{minWidth:60},children:"简单"}),e.jsx("input",{type:"number",value:Math.round(_),onChange:o=>{const u=Number(o.target.value||0),d=k(u,0,f-1);W(d),m(d,f)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"中等"}),e.jsx("input",{type:"number",value:Math.round(f-_),onChange:o=>{const u=Number(o.target.value||0),d=k(_+u,_+1,100);C(d),m(_,d)},style:{width:72}}),e.jsx("label",{style:{minWidth:60},children:"困难"}),e.jsx("input",{type:"number",value:Math.round(100-f),onChange:o=>{const u=Number(o.target.value||0),d=k(100-u,_+1,100);C(d),m(_,d)},style:{width:72}})]})]})};return e.jsxs("div",{children:[e.jsx(pe,{title:"试卷设计"}),e.jsx("div",{className:ge.content,children:e.jsx("div",{className:I.layout,children:e.jsx("div",{className:I.leftPane,children:e.jsxs("div",{className:I.canvasCard,children:[e.jsxs("div",{className:I.canvasHeader,children:[e.jsxs("div",{className:"titleLeft",children:["已创建的试卷 (",h.length,")"]}),e.jsx("div",{children:e.jsx("button",{className:I.editBtn,onClick:()=>w(!0),children:"新建试卷"})})]}),e.jsx("div",{style:{padding:12},children:e.jsx(Me,{items:h,keyExtractor:l=>l.id,editable:{getValue:l=>l.title},renderItem:l=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:I.title,children:l.title}),e.jsxs("div",{className:I.meta,children:[l.subtitle&&e.jsx("span",{className:I.subtitle,children:l.subtitle}),l.createdAt&&e.jsx("span",{className:I.time,children:new Date(l.createdAt).toLocaleString()})]})]}),actions:[{label:"继续编辑",onClick:l=>p(l.id),className:ce.btnEdit},{label:"重命名",isRename:!0,onClick:(l,M)=>M&&$(l.id,M),className:ce.btnRename},{label:"删除",onClick:l=>{r(l.id),g(l.title||"未命名试卷")},className:ce.btnDanger}],emptyText:"暂无试卷。"})})]})})})}),e.jsx(ve,{visible:S,title:"新建试卷",onClose:()=>w(!1),children:e.jsxs("div",{children:[e.jsx("p",{style:{color:"#666"},children:"填写试卷基本信息以便快速生成试卷初稿。"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(Le,{fields:[{name:"name",label:"试卷标题",placeholder:"例如： 期末考试 2025",defaultValue:"未命名试卷"},{name:"content",label:"考察内容",type:"textarea",placeholder:"例如： 操作系统、数据库",rows:6},{name:"materials",label:"相关资料",type:"file",multiple:!0,accept:".pdf,.docx,.pptx"},{name:"difficulty",label:"难度预设比例",defaultValue:{easy:30,medium:50,hard:20},render:(l,M)=>e.jsx(v,{value:l,onChange:M})},{name:"choose_count",label:"选择",type:"number",defaultValue:10},{name:"short_count",label:"简答",type:"number",defaultValue:4},{name:"fill_count",label:"填空",type:"number",defaultValue:0},{name:"program_count",label:"编程",type:"number",defaultValue:0},{name:"essay_count",label:"论述",type:"number",defaultValue:0}],submitText:"生成初稿",submitLoading:B,submitLoadingText:"生成中",submitDisabled:B,onSubmit:l=>{B||(N(!0),setTimeout(()=>{L(l),w(!1),N(!1)},600))}})})]})}),e.jsx(fe,{open:!!A,title:"删除试卷",description:`确认删除「${x}」吗？此操作不可恢复。`,confirmText:"确认删除",danger:!0,onCancel:()=>{r(null),g("")},onConfirm:()=>{A&&E(A),r(null),g("")}})]})},Qe="_headerRow_1ar90_2",Je="_headerCard_1ar90_9",Ke="_titleInputLarge_1ar90_49",Ge="_rightAction_1ar90_82",Xe="_scoreBox_1ar90_88",Ye="_scoreLabel_1ar90_96",ze="_scoreValue_1ar90_101",Ue="_backBtn_1ar90_107",Ze="_previewBtn_1ar90_108",es="_layout_1ar90_129",ss="_rightPane_1ar90_136",ts="_aiCard_1ar90_140",as="_paperArea_1ar90_154",ns="_paperCard_1ar90_160",rs="_paperHeader_1ar90_170",is="_paperBody_1ar90_176",ls="_questionStack_1ar90_182",os="_questionCard_1ar90_188",cs="_selectedCard_1ar90_208",ds="_draggingCard_1ar90_213",ms="_cardHeader_1ar90_218",us="_cardIndex_1ar90_225",hs="_cardMeta_1ar90_230",xs="_dragHandle_1ar90_245",_s="_cardStem_1ar90_251",ps="_cardFooter_1ar90_257",gs="_cardActions_1ar90_273",vs="_card_1ar90_218",fs="_qualityCard_1ar90_287",js="_panelWrap_1ar90_295",ys="_recommendOverlay_1ar90_301",bs="_recommendHidden_1ar90_317",Ns="_recommendWrap_1ar90_323",Cs="_structureCard_1ar90_332",ws="_structureHeader_1ar90_339",Bs="_structureBody_1ar90_347",Ss="_structureRow_1ar90_353",Ts="_structureLabel_1ar90_359",ks="_structureValue_1ar90_365",Rs="_knowledgeTags_1ar90_371",Ds="_knowledgeTag_1ar90_371",Ls="_knowledgeEmpty_1ar90_385",Es="_dialogCard_1ar90_390",Ms="_dialogBody_1ar90_398",Is="_modalDialogCard_1ar90_405",As="_modalDialogBody_1ar90_411",$s="_previewModal_1ar90_418",Hs="_qualitySummary_1ar90_424",Ps="_qualityBox_1ar90_428",Vs="_qualityHint_1ar90_437",Os="_qualityResult_1ar90_442",Ws="_qualityStatus_1ar90_447",qs="_qualityAdvice_1ar90_453",Fs="_coverageRow_1ar90_459",Qs="_coverageLabel_1ar90_465",Js="_coverageBarWrap_1ar90_470",Ks="_coverageBar_1ar90_470",Gs="_coverageFill_1ar90_481",Xs="_coveragePercent_1ar90_487",Ys="_difficultyRow_1ar90_494",zs="_diffPercents_1ar90_502",Us="_metricsRow_1ar90_510",Zs="_metric_1ar90_510",et="_metricLabel_1ar90_523",st="_metricValue_1ar90_528",tt="_metricText_1ar90_534",at="_recommendCard_1ar90_540",nt="_switchBtn_1ar90_548",rt="_recommendList_1ar90_568",it="_recItem_1ar90_575",lt="_recHeader_1ar90_584",ot="_recTags_1ar90_590",ct="_recTag_1ar90_590",dt="_recStem_1ar90_604",mt="_recReplaceBtn_1ar90_610",ut="_cardTitle_1ar90_627",ht="_cardBody_1ar90_632",xt="_empty_1ar90_636",_t="_scoreInput_1ar90_678",pt="_modifyBtn_1ar90_685",gt="_deleteBtn_1ar90_701",vt="_insertWrap_1ar90_717",ft="_insertBtn_1ar90_723",jt="_optionsList_1ar90_739",yt="_optionItem_1ar90_745",bt="_modalOverlay_1ar90_763",Nt="_modalContent_1ar90_776",Ct="_modalColumns_1ar90_785",wt="_modalActions_1ar90_790",Bt="_modalCloseBtn_1ar90_797",St="_generateBtn_1ar90_813",Tt="_confirmBtn_1ar90_829",kt="_analysisWrap_1ar90_845",Rt="_analysisBox_1ar90_853",Dt="_analysisTitle_1ar90_861",Lt="_analysisContent_1ar90_867",t={headerRow:Qe,headerCard:Je,titleInputLarge:Ke,rightAction:Ge,scoreBox:Xe,scoreLabel:Ye,scoreValue:ze,backBtn:Ue,previewBtn:Ze,layout:es,rightPane:ss,aiCard:ts,paperArea:as,paperCard:ns,paperHeader:rs,paperBody:is,questionStack:ls,questionCard:os,selectedCard:cs,draggingCard:ds,cardHeader:ms,cardIndex:us,cardMeta:hs,dragHandle:xs,cardStem:_s,cardFooter:ps,cardActions:gs,card:vs,qualityCard:fs,panelWrap:js,recommendOverlay:ys,recommendHidden:bs,recommendWrap:Ns,structureCard:Cs,structureHeader:ws,structureBody:Bs,structureRow:Ss,structureLabel:Ts,structureValue:ks,knowledgeTags:Rs,knowledgeTag:Ds,knowledgeEmpty:Ls,dialogCard:Es,dialogBody:Ms,modalDialogCard:Is,modalDialogBody:As,previewModal:$s,qualitySummary:Hs,qualityBox:Ps,qualityHint:Vs,qualityResult:Os,qualityStatus:Ws,qualityAdvice:qs,coverageRow:Fs,coverageLabel:Qs,coverageBarWrap:Js,coverageBar:Ks,coverageFill:Gs,coveragePercent:Xs,difficultyRow:Ys,diffPercents:zs,metricsRow:Us,metric:Zs,metricLabel:et,metricValue:st,metricText:tt,recommendCard:at,switchBtn:nt,recommendList:rt,recItem:it,recHeader:lt,recTags:ot,recTag:ct,recStem:dt,recReplaceBtn:mt,cardTitle:ut,cardBody:ht,empty:xt,scoreInput:_t,modifyBtn:pt,deleteBtn:gt,insertWrap:vt,insertBtn:ft,optionsList:jt,optionItem:yt,modalOverlay:bt,modalContent:Nt,modalColumns:Ct,modalActions:wt,modalCloseBtn:Bt,generateBtn:St,confirmBtn:Tt,analysisWrap:kt,analysisBox:Rt,analysisTitle:Dt,analysisContent:Lt},Et=({examId:h="default-exam",title:p="未命名试卷",questions:L=[],onBack:E})=>{const $="exam_design_exams_v1",S=()=>{try{const s=localStorage.getItem($);return s?JSON.parse(s):[]}catch(s){return console.warn("loadExams failed",s),[]}},w=s=>{try{localStorage.setItem($,JSON.stringify(s))}catch(a){console.warn("saveExams failed",a)}},B=(s,a)=>{try{const n=S(),c=n.findIndex(D=>D.id===h),y={id:h,title:a??N??p??"未命名试卷",createdAt:Date.now(),questions:s};c>=0?n[c]={...n[c],title:y.title,questions:s}:n.push(y),w(n)}catch(n){console.warn("persistExam failed",n)}},[N,A]=i.useState(p),[r,x]=i.useState(null),[g,v]=i.useState(null),[l,M]=i.useState(!1),[O,_]=i.useState(!1),[W,f]=i.useState(!1),[C,H]=i.useState(null),T=s=>s?`${h}-q-${s}`:h;i.useEffect(()=>{let a;return r?(_(!0),f(!1),requestAnimationFrame(()=>f(!0))):(f(!1),a=window.setTimeout(()=>_(!1),320)),()=>{a&&window.clearTimeout(a)}},[r]);const k=s=>H(s),[m,R]=i.useState(L);i.useEffect(()=>R(L),[L]),i.useEffect(()=>{const s=S(),a=s.find(n=>n.id===h);if(a)R(a.questions||[]),A(a.title||p);else{const n={id:h,title:p||"未命名试卷",createdAt:Date.now(),questions:L};s.push(n),w(s)}},[]),i.useEffect(()=>{const s=S(),a=s.findIndex(c=>c.id===h),n={id:h,title:N||p||"未命名试卷",createdAt:Date.now(),questions:m};a>=0?s[a]={...s[a],title:n.title,questions:n.questions}:s.push(n),w(s)},[m,N,h,p]);const[o,u]=i.useState(!1),[d,b]=i.useState(null),[j,Q]=i.useState(null),[Z,J]=i.useState(""),[me,ue]=i.useState(5),[P,ee]=i.useState(""),[q,se]=i.useState("简答"),[te,ae]=i.useState("中等"),[ne,re]=i.useState("理解"),[F,V]=i.useState([]),[ie,le]=i.useState("");i.useEffect(()=>{if(o)if(j){const s=m.find(a=>a.id===j);J(s?.stem||""),ue(s?.score??5),ee(s?.knowledge||""),se(s?.type||"简答"),ae(s?.difficulty||"中等"),re(s?.cognition||"理解"),V(s?.options&&s.options.length?s.options.slice():["",""]),le(s?.answerAnalysis||"")}else J(""),ue(5),ee(""),se("简答"),ae("中等"),re("理解"),V(["",""]),le("")},[o,j,m]);const je=()=>{const s={id:Date.now().toString(),stem:Z,score:me,type:q,options:F&&F.length?F.map(n=>n.trim()).filter(Boolean):void 0,knowledge:P,difficulty:te,cognition:ne,answerAnalysis:ie};let a;if(j)a=m.map(n=>n.id===j?{...n,stem:Z,score:me,type:q,options:s.options,knowledge:P,difficulty:te,cognition:ne,answerAnalysis:ie}:n);else if(d==null)a=[...m,s];else{const n=Math.max(0,Math.min(d+1,m.length)),c=[...m];c.splice(n,0,s),a=c}R(a),B(a),u(!1),Q(null),b(null)},K=m.map((s,a)=>({id:s.id,index:a+1,stem:s.stem,score:s.score??0,options:s.options??[]})),he=K.reduce((s,a)=>s+a.score,0),ye=m.reduce((s,a)=>{const n=a.type||"未标注";return s[n]=(s[n]||0)+1,s},{}),be=m.reduce((s,a)=>{const n=a.difficulty||"未标注";return s[n]=(s[n]||0)+1,s},{}),Ne=m.reduce((s,a)=>{const n=a.knowledge||"未标注";return s[n]=(s[n]||0)+1,s},{}),xe=s=>{const a=Object.entries(s);return a.length===0?"暂无题目":a.map(([n,c])=>`${n} ×${c}`).join(" / ")},_e=Object.entries(Ne),G=(()=>{const a=[`# ${N||p||"未命名试卷"}`,"",`- 题量：${K.length}`,`- 总分：${he}`,""];return K.length===0?(a.push("暂无题目。"),a.join(`
`)):(K.forEach(n=>{const c=n.score?`（${n.score}分）`:"";a.push(`## ${n.index}. ${n.stem}${c}`),n.options.length>0&&(a.push(""),n.options.forEach((y,D)=>{a.push(`- ${String.fromCharCode(65+D)}. ${y}`)})),a.push("")}),a.join(`
`).trim())})(),Ce=s=>a=>{a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",s),v(s)},we=()=>{v(null)},Be=s=>{s.preventDefault()},Se=s=>a=>{a.preventDefault();const n=a.dataTransfer.getData("text/plain");!n||n===s||(R(c=>{const y=c.findIndex(oe=>oe.id===n),D=c.findIndex(oe=>oe.id===s);if(y<0||D<0)return c;const Y=[...c],[De]=Y.splice(y,1);return Y.splice(D,0,De),B(Y),Y}),v(null))},X=[{id:"r1",tags:["数据结构","困难","选择"],stem:"红黑树中，红色节点的子节点必须是？"},{id:"r2",tags:["数据结构","简单","选择"],stem:"栈的特点是？"}],Te=[{id:"r3",tags:["算法","中等","填空"],stem:"二分查找的前提是什么？"},{id:"r4",tags:["数据库","简单","选择"],stem:"SQL 中用于筛选的关键字是？"}],[ke,Re]=i.useState(X);return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(Ee,{}),e.jsx(pe,{title:"试卷设计"}),e.jsxs("div",{className:ge.content,children:[e.jsx("div",{className:t.headerCard,children:e.jsxs("div",{className:t.headerRow,children:[e.jsx("input",{className:t.titleInputLarge,type:"text",value:N,onChange:s=>A(s.target.value),placeholder:"未命名试卷"}),e.jsxs("div",{className:t.rightAction,children:[e.jsxs("div",{className:t.scoreBox,children:[e.jsx("div",{className:t.scoreLabel,children:"总分"}),e.jsx("div",{className:t.scoreValue,children:he})]}),e.jsx("button",{className:t.backBtn,onClick:E,children:"返回试卷列表"}),e.jsx("button",{className:t.previewBtn,onClick:()=>M(!0),children:"试卷预览"}),e.jsx(Ie,{button:"导出",items:[{label:"导出 PDF",onClick:()=>Ae(N||p||"exam",G)},{label:"导出 Docx",onClick:()=>$e(N||p||"exam",G)},{label:"导出 Markdown",onClick:()=>He(N||p||"exam",G)}]})]})]})}),e.jsxs("div",{className:t.layout,children:[e.jsx("div",{className:t.leftPane,children:e.jsx("div",{className:t.paperArea,children:e.jsxs("div",{className:t.paperCard,children:[e.jsx("div",{className:t.paperHeader,children:"试卷"}),e.jsxs("div",{className:t.paperBody,children:[m.length===0&&e.jsx("div",{className:t.empty,children:"当前试卷暂无题目"}),m.map((s,a)=>e.jsxs("div",{className:t.questionStack,children:[e.jsxs("div",{className:`${t.questionCard} ${r===s.id?t.selectedCard:""} ${g===s.id?t.draggingCard:""}`,onClick:()=>x(n=>n===s.id?null:s.id),role:"button",tabIndex:0,draggable:!0,onDragStart:Ce(s.id),onDragEnd:we,onDragOver:Be,onDrop:Se(s.id),children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsxs("div",{className:t.cardIndex,children:["#",a+1]}),e.jsxs("div",{className:t.cardMeta,children:[e.jsx("span",{children:s.knowledge||"未标注"}),e.jsx("span",{children:s.difficulty||"中等"}),e.jsx("span",{children:s.type||"简答"})]}),e.jsx("span",{className:t.dragHandle,"aria-hidden":"true",children:"⋮⋮"})]}),e.jsxs("div",{className:t.cardStem,children:[s.stem,s.options&&s.options.length>0&&e.jsx("ul",{className:t.optionsList,children:s.options.map((n,c)=>e.jsxs("li",{className:t.optionItem,children:[String.fromCharCode(65+c),". ",n]},c))})]}),e.jsx("div",{className:t.cardFooter,onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:t.cardActions,children:[e.jsxs("label",{className:t.scoreLabel,children:["分值",e.jsx("input",{type:"number",value:s.score??5,onChange:n=>{const c=Number(n.target.value||0),y=m.map(D=>D.id===s.id?{...D,score:c}:D);R(y),B(y)},className:t.scoreInput})]}),e.jsx("button",{className:t.modifyBtn,onClick:()=>{Q(s.id),b(a-1),u(!0)},children:"修改"}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除题目",description:"确认删除该题目吗？此操作不可恢复。",confirmText:"确认删除",danger:!0,onConfirm:()=>{const n=m.filter(c=>c.id!==s.id);R(n),B(n),r===s.id&&x(null)}})},children:"删除"})]})})]}),r===s.id&&e.jsxs("div",{className:t.analysisWrap,children:[e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"知识点分析"}),e.jsx("div",{className:t.analysisContent,children:"当前题目覆盖「数据库」，建议搭配相邻知识点，扩展覆盖范围。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"难度分析"}),e.jsx("div",{className:t.analysisContent,children:"偏基础概念，适合作为入门或热身题。"})]}),e.jsxs("div",{className:t.analysisBox,children:[e.jsx("div",{className:t.analysisTitle,children:"答案分析"}),e.jsx("div",{className:t.analysisContent,children:s.answerAnalysis||"暂无答案分析。"})]})]}),e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(a),Q(null),u(!0)},children:"+ 插入题目"})})]},s.id)),m.length===0&&e.jsx("div",{className:t.insertWrap,children:e.jsx("button",{className:t.insertBtn,onClick:()=>{b(-1),Q(null),u(!0)},children:"+ 插入题目"})})]})]})})}),e.jsx("div",{className:t.rightPane,children:e.jsxs("div",{className:t.aiCard,children:[e.jsxs("div",{className:t.panelWrap,children:[e.jsxs("div",{className:t.qualityCard,children:[e.jsx("div",{className:t.cardTitle,children:"试卷质量画像"}),e.jsx("div",{className:t.qualitySummary,children:e.jsxs("div",{className:t.qualityBox,children:[e.jsx("div",{className:t.qualityHint,children:"综合评价"}),e.jsxs("div",{className:t.qualityResult,children:[e.jsx("div",{className:t.qualityStatus,children:"可用"}),e.jsx("div",{className:t.qualityAdvice})]})]})}),e.jsxs("div",{className:t.coverageRow,children:[e.jsx("div",{className:t.coverageLabel,children:"覆盖度"}),e.jsx("div",{className:t.coverageBarWrap,children:e.jsx("div",{className:t.coverageBar,children:e.jsx("div",{className:t.coverageFill,style:{width:"83%"}})})}),e.jsx("div",{className:t.coveragePercent,children:"83%"})]}),e.jsxs("div",{className:t.difficultyRow,children:[e.jsx("div",{className:t.diffLabel,children:"难度结构"}),e.jsx("div",{className:t.diffText,children:"合理"})]}),e.jsxs("div",{className:t.diffPercents,children:[e.jsx("div",{children:"易 30%"}),e.jsx("div",{children:"中 50%"}),e.jsx("div",{children:"难 20%"})]}),e.jsxs("div",{className:t.metricsRow,children:[e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"区分度"}),e.jsx("div",{className:t.metricValue,children:"0.42"}),e.jsx("div",{className:t.metricText,children:"良好"})]}),e.jsxs("div",{className:t.metric,children:[e.jsx("div",{className:t.metricLabel,children:"信度"}),e.jsx("div",{className:t.metricValue,children:"0.78"}),e.jsx("div",{className:t.metricText,children:"可接受"})]})]})]}),e.jsxs("div",{className:t.structureCard,children:[e.jsx("div",{className:t.structureHeader,children:e.jsx("div",{className:t.cardTitle,children:"试卷概览"})}),e.jsxs("div",{className:t.structureBody,children:[e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"题型分布"}),e.jsx("div",{className:t.structureValue,children:xe(ye)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"难度分布"}),e.jsx("div",{className:t.structureValue,children:xe(be)})]}),e.jsxs("div",{className:t.structureRow,children:[e.jsx("div",{className:t.structureLabel,children:"知识点覆盖"}),e.jsx("div",{className:t.knowledgeTags,children:_e.length?_e.map(([s,a])=>e.jsxs("span",{className:t.knowledgeTag,children:[s," ×",a]},s)):e.jsx("span",{className:t.knowledgeEmpty,children:"暂无"})})]})]})]})]}),O&&e.jsx("div",{className:`${t.recommendOverlay} ${W?"":t.recommendHidden}`,children:e.jsxs("div",{className:t.recommendWrap,children:[e.jsxs("div",{className:t.recommendCard,children:[e.jsx("div",{className:t.cardTitle,children:"推荐变题"}),e.jsx("button",{className:t.switchBtn,onClick:()=>{Re(s=>s===X||s[0]?.id===X[0].id?Te:X)},children:"换一换"}),e.jsx("div",{className:t.recommendList,children:ke.map(s=>e.jsxs("div",{className:t.recItem,children:[e.jsxs("div",{className:t.recHeader,children:[e.jsx("div",{className:t.recTags,children:s.tags.map(a=>e.jsx("span",{className:t.recTag,children:a},a))}),e.jsx("button",{className:t.recReplaceBtn,onClick:()=>{const a=m.map(n=>n.id===r?{...n,stem:s.stem}:n);R(a),B(a)},children:"替换"})]}),e.jsx("div",{className:t.recStem,children:s.stem})]},s.id))})]}),e.jsx("div",{className:`${t.card} ${t.dialogCard}`,children:e.jsx("div",{className:t.dialogBody,children:e.jsx(U,{dialogId:T(r),botName:"题目助手",initMessage:"这是本题的讨论对话。"})})})]})})]})})]})]}),o&&e.jsx("div",{className:t.modalOverlay,onClick:()=>u(!1),children:e.jsxs("div",{className:t.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:t.modalColumns,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{marginTop:0},children:j?"修改题目":"生成插入题目"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{marginBottom:6},children:"题干"}),e.jsx("textarea",{value:Z,onChange:s=>J(s.target.value),rows:5,style:{width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"知识点"}),e.jsx("input",{value:P,onChange:s=>ee(s.target.value),placeholder:"例如：数据库",style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"题型"}),e.jsxs("select",{value:q,onChange:s=>{const a=s.target.value;se(a),a==="选择"&&F.length<2&&V(["",""])},style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简答"}),e.jsx("option",{children:"选择"}),e.jsx("option",{children:"填空"}),e.jsx("option",{children:"编程"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"难度"}),e.jsxs("select",{value:te,onChange:s=>ae(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"简单"}),e.jsx("option",{children:"中等"}),e.jsx("option",{children:"困难"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:6},children:"认知层次"}),e.jsxs("select",{value:ne,onChange:s=>re(s.target.value),style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"},children:[e.jsx("option",{children:"记忆"}),e.jsx("option",{children:"理解"}),e.jsx("option",{children:"应用"}),e.jsx("option",{children:"分析"})]})]})]}),q==="选择"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"选项"}),F.map((s,a)=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsx("div",{style:{width:28,textAlign:"center",fontWeight:700},children:String.fromCharCode(65+a)}),e.jsx("input",{value:s,onChange:n=>V(c=>{const y=[...c];return y[a]=n.target.value,y}),placeholder:`选项 ${String.fromCharCode(65+a)}`,style:{flex:1,padding:8,borderRadius:8,border:"1px solid #eee"}}),e.jsx("button",{className:t.deleteBtn,onClick:()=>{k({title:"删除选项",description:"确认删除该选项吗？",confirmText:"确认删除",danger:!0,onConfirm:()=>{V(n=>n.length>1?n.filter((c,y)=>y!==a):n)}})},children:"删除"})]},a)),e.jsx("div",{children:e.jsx("button",{className:t.insertBtn,onClick:()=>V(s=>[...s,""]),children:"+ 添加选项"})})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{marginBottom:6},children:"答案分析"}),e.jsx("textarea",{value:ie,onChange:s=>le(s.target.value),rows:3,style:{width:"100%",padding:"8px",borderRadius:8,border:"1px solid #eee"}})]})]}),e.jsxs("div",{style:{width:360,marginLeft:16},children:[e.jsx("div",{className:t.cardTitle,children:"对话记录"}),e.jsx("div",{className:`${t.card} ${t.modalDialogCard}`,style:{marginTop:8},children:e.jsx("div",{className:`${t.cardBody} ${t.modalDialogBody}`,children:e.jsx(U,{dialogId:`${h}-gen`,botName:"生成助手",initMessage:"在此与模型对话以协助生成题目。"})})})]})]}),e.jsxs("div",{className:t.modalActions,children:[e.jsx("button",{className:t.generateBtn,onClick:()=>{const a=`${P?`基于「${P}」`:""}${q}题：请描述 ${P||"相关"} 的核心概念。`;J(a)},children:"生成题目"}),e.jsx("button",{onClick:()=>{je()},className:t.confirmBtn,children:j?"保存修改":"确认加入"}),e.jsx("button",{onClick:()=>u(!1),className:t.modalCloseBtn,children:"取消"})]})]})}),e.jsx(fe,{open:!!C,title:C?.title,description:C?.description,confirmText:C?.confirmText,danger:C?.danger,onCancel:()=>H(null),onConfirm:()=>{C&&C.onConfirm(),H(null)}}),e.jsx(ve,{visible:l,title:"试卷预览",onClose:()=>M(!1),children:e.jsx("div",{className:t.previewModal,children:e.jsx(Pe,{value:G,showControls:!1})})})]})})},de="exam_design_exams_v1",$t=()=>{const[h,p]=i.useState([]),[L,E]=i.useState("list"),[$,S]=i.useState(null);i.useEffect(()=>{try{const r=localStorage.getItem(de);r&&p(JSON.parse(r))}catch(r){console.error("load exams",r)}},[]);const w=r=>{p(r);try{localStorage.setItem(de,JSON.stringify(r))}catch(x){console.error(x)}},B=r=>{const x=Date.now().toString(),g=r.name||"未命名试卷",l=[{id:x,title:g,questions:[],createdAt:Date.now()},...h];w(l),S(x),E("detail")},N=r=>{const x=h.filter(g=>g.id!==r);w(x);try{U.clearDialog(r);const g=h.find(v=>v.id===r);g&&g.questions.forEach(v=>U.clearDialog(`${r}-q-${v.id}`))}catch{}L==="detail"&&E("list"),$===r&&S(null)},A=r=>{if(!r)return;h.find(g=>g.id===r)&&(S(r),E("detail"))};if(L==="detail"){const r=h.find(x=>x.id===$)||h[0]||null;return e.jsx(Et,{examId:r?.id,title:r?.title,questions:r?.questions,onBack:()=>{try{const x=localStorage.getItem(de);x&&p(JSON.parse(x))}catch(x){console.error("load exams",x)}E("list"),S(null)}})}return e.jsx(Fe,{items:h.map(r=>({id:r.id,title:r.title,subtitle:"",createdAt:r.createdAt})),onEdit:r=>{r?A(r):E("detail")},onCreate:B,onDelete:r=>{r&&N(r)},onRename:(r,x)=>{const g=h.map(v=>v.id===r?{...v,title:x||v.title}:v);w(g)}})};export{$t as default};
